var T=Object.create;var p=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var O=e=>p(e,"__esModule",{value:!0});var F=(e,n)=>{O(e);for(var t in n)p(e,t,{get:n[t],enumerable:!0})},J=(e,n,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of L(n))!z.call(e,i)&&i!=="default"&&p(e,i,{get:()=>n[i],enumerable:!(t=E(n,i))||t.enumerable});return e},w=e=>J(O(p(e!=null?T(N(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);F(exports,{default:()=>I});var $=w(require("fs/promises"));var x=w(require("fs/promises")),u={index:-1,used:{ignore:{},mapping:{},directory:{demand:{},fetch:{}}},langs:{},translate:{_:[],length:0}};async function v(e,n){let t=await S(),i=t.props;console.groupCollapsed("\u8A2D\u5B9A\u5C6C\u6027\u4E2D"),console.log(`\u7E7C\u627F ${i.length} \u500B\u5C6C\u6027`);let o=e.properties;u.langs=e.localization;for(let d of n)g(o,d,i);return console.groupEnd(),console.log(`\u5275\u5EFA ${Object.keys(i.index).length} \u500B\u5C6C\u6027`),Object.keys(e.localization).length||(e.localization=void 0),await x.default.writeFile("project.cache.json",JSON.stringify(t)),u.used}function g(e,n,t,i=[]){let o=i.concat(n.condition||[]),d=["menu","item","tips"];if((s=>"type"in s&&d.includes(s.type))(n)){switch(console.groupCollapsed(`|${n.id.split("/").at(-1)}|${n.type}|`),n.type){case"menu":{let s=[];n.all&&s.push({label:n.all,value:-1})&&console.debug("|-\u5141\u8A31 ALL");let l=[];for(let r in n.options){let f=i.concat(n.condition||[]),a=n.options[r];s.push({label:a.label,value:parseInt(r)}),l.push(()=>{let m=`${c}.value===${r}`,P=n.all?`(${c}.value===-1||${m})`:m;f.push(P);for(let b of a.value)b.id=`${n.id}/${b.id}`,g(e,b,t,f)})}let c=g(e,{options:s,condition:o,id:n.id,type:"combo",text:n.text,icon:n.icon,value:n.value,ignore:n.ignore,fixed_order:n.fixed_order},t);l.forEach(r=>r());break}case"item":{let s=()=>{o.push(`${l}.value`);for(let c of n.list)c.id=`${n.id}/${c.id}`,g(e,c,t,o)},l=g(e,{condition:o,id:n.id,type:"bool",text:n.text,value:n.value,ignore:n.ignore,...n.custom},t);s();break}case"tips":{let s=n.list;if(s=s.map(r=>{typeof r=="string"&&(r={"en-us":r});let f={};for(let a in r){let m=typeof n.text=="string"?n.text:a in n.text?n.text[a]:n.text["en-us"];f[a]=`<h2>${m}</h2>`+r[a]}return _(f)}),s.length===1){g(e,{ignore:!0,id:`${n.id}`,text:s[0]},t);break}let l=[],c=!0;s.forEach((r,f)=>{l.push(g(e,{ignore:!0,id:`${n.id}/${f}`,type:"bool",value:c,fixed_order:!c,text:r},t,[a=>`${a}.value${c?"===":"!=="}{{}}.value`])),c&&(c=!1)}),l.forEach((r,f)=>e[r].condition=e[r].condition.replace("{{}}",l.at(--f)));break}}console.groupEnd()}else{let s=n.id;console.log(`|${s.split("/").at(-1)}|${"type"in n?n.type:"text"}|`);let l=t.index[s]||(t.index[s]=h(t.length++));if(u.used[n.ignore?"ignore":"mapping"][s]=l,"type"in n)switch(n.type){case"color":{n.value=n.value.split(" ").map(a=>parseInt(a)/255).join(" ");break}case"directory":{u.used.directory[n.mode==="fetchall"?"fetch":"demand"][s]=l;break}}"options"in n&&n.options.map(a=>(a.label=_(a.label),a));let c=n.fixed_order?u.index:++u.index,r=n;r.id=void 0,r.ignore=void 0,r.fixed_order=void 0;let f=o.map(a=>typeof a=="string"?a:a(l));return r.condition=o.length===0?void 0:f.join("&&"),n.text&&(r.text=_(n.text)),e[l]={...r,order:c},l}}function _(e){if(typeof e!="object"){if(e.indexOf("ui_")===0)return e;e={"en-us":e}}let n="",t=JSON.stringify(e),i=u.translate._.indexOf(t);if(i!==-1)return"ui_"+h(i);u.translate._.push(t),n="ui_"+h(u.translate.length++);for(let o in e)u.langs[o]||(u.langs[o]={}),u.langs[o][n]=e[o].replace(/ /yg,"&emsp;");return n}function h(e){let n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t=52;if(typeof e=="string"){if(e.length==1)return n.indexOf(e);let i=0,o=0,d=e.split("").reverse();for(let y of d)i+=n.indexOf(y)*t**o++;return i}else{let i=[];if(e===0)return n[e];for(;e;){let o=e%t;i.unshift(n[o]),e=(e-o)/t}return i.join("")}}async function S(){let e=await x.default.readFile("project.cache.json","utf8").catch(()=>!1),n={props:{length:0,index:{}}};if(e===!1)return n;try{let t=JSON.parse(e);return"length"in t.props&&"index"in t.props?t:{...t,...n}}catch{return n}}var C={builder:K},A=["contentrating","description","visibility","workshopid","preview","builder","title","file","tags"];async function K(e,n=[],t){let i={tags:[],title:"NewProject",description:"hello world",type:"Web",audio:!1,file:"index.html",visibility:"public",contentrating:"Everyone",...e},o={general:{properties:{},localization:{}}};console.groupCollapsed("\u521D\u59CB\u5316\u914D\u7F6E\u6A94\u6848"),Object.keys(i).forEach(s=>{let l=i[s];A.indexOf(s)!==-1&&(o[s]=l),s==="audio"&&(o.general.supportsaudioprocessing=l),s==="workshopid"&&(o.workshopurl="steam://url/CommunityFilePage/"+l)});let d=await v(o.general,n),y={config:t?.custom?k(o,t?.custom):o,types:d};return console.log("\u6DFB\u52A0\u81EA\u8A02\u5C6C\u6027"),t?.out_types&&await $.default.writeFile(t?.out_types,JSON.stringify(y.types)),console.log("\u7DE8\u8B6F\u6210\u529F"),console.groupEnd(),t?.out_config&&await $.default.writeFile(t?.out_config,JSON.stringify(y.config)),y}function j(e){return e&&typeof e=="object"&&!Array.isArray(e)}function k(e,...n){if(!n.length)return e;let t=n.shift();if(j(e)&&j(t))for(let i in t)j(t[i])?(e[i]||Object.assign(e,{[i]:{}}),k(e[i],t[i])):Object.assign(e,{[i]:t[i]});return k(e,...n)}var I={config:C};0&&(module.exports={});
